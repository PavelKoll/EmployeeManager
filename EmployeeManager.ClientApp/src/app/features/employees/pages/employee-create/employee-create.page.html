<div class="d-flex justify-content-between align-items-center mb-3">
  <div>
    <h1 class="h4 page-title mb-0">Vytvoření zaměstnance</h1>
    <div class="text-body-secondary small">Přidání nového zaměstnance</div>
  </div>

  <a class="btn btn-sm btn-outline-secondary" routerLink="/employees">
    <i class="bi bi-arrow-left me-1"></i>Zpět
  </a>
</div>

<div *ngIf="error()" class="alert alert-danger">{{ error() }}</div>

<div *ngIf="loading()" class="d-flex align-items-center gap-2 text-body-secondary mb-3">
  <div class="spinner-border spinner-border-sm" aria-hidden="true"></div>
  Načítám...
</div>

<form *ngIf="ready()" [formGroup]="form" (ngSubmit)="create()">
  <fieldset [disabled]="saving()">
    <div class="card shadow-sm">
      <div class="card-body">
        <div class="row g-3">

          <div class="col-12 col-md-6">
            <label class="form-label">Jméno *</label>
            <input class="form-control" formControlName="firstName"
              [class.is-invalid]="form.controls.firstName.touched && form.controls.firstName.invalid" />
            <div class="invalid-feedback">Povinné</div>
          </div>

          <div class="col-12 col-md-6">
            <label class="form-label">Příjmení *</label>
            <input class="form-control" formControlName="lastName"
              [class.is-invalid]="form.controls.lastName.touched && form.controls.lastName.invalid" />
            <div class="invalid-feedback">Povinné</div>
          </div>

          <div class="col-12 col-md-6">
            <label class="form-label">Prostřední jméno</label>
            <input class="form-control" formControlName="middleName" />
          </div>

          <div class="col-12 col-md-6">
            <label class="form-label">Datum narození *</label>
            <input type="date" class="form-control" formControlName="birthDate"
              [class.is-invalid]="form.controls.birthDate.touched && form.controls.birthDate.invalid" />
            <div class="invalid-feedback">Povinné</div>
          </div>

          <div class="col-12 col-md-6">
            <label class="form-label">Pohlaví *</label>
            <div class="dropdown w-100">
              <button type="button"
                class="btn btn-outline-secondary dropdown-toggle w-100 text-start"
                data-bs-toggle="dropdown">
                {{ genderText() }}
              </button>
              <ul class="dropdown-menu w-100">
                <li *ngFor="let g of genderOptions">
                  <button type="button" class="dropdown-item" (click)="setGender(g.value)">
                    {{ g.label }}
                  </button>
                </li>
              </ul>
            </div>
            <div *ngIf="form.controls.gender.touched && form.controls.gender.invalid"
              class="invalid-feedback d-block">
              Povinné
            </div>
          </div>

          <div class="col-12 col-md-6">
            <label class="form-label">E-mail *</label>
            <input type="email" class="form-control" formControlName="email"
              [class.is-invalid]="form.controls.email.touched && form.controls.email.invalid" />
            <div class="invalid-feedback">Neplatný e-mail / povinné</div>
          </div>

          <div class="col-12 col-md-6">
            <label class="form-label">Telefon *</label>
            <input class="form-control" formControlName="phoneNumber"
              [class.is-invalid]="form.controls.phoneNumber.touched && form.controls.phoneNumber.invalid" />
            <div class="invalid-feedback">Povinné</div>
          </div>

          <div class="col-12 col-md-6">
            <label class="form-label">Datum nástupu *</label>
            <input type="date" class="form-control" formControlName="joinedDate"
              [class.is-invalid]="form.controls.joinedDate.touched && form.controls.joinedDate.invalid" />
            <div class="invalid-feedback">Povinné</div>
          </div>

          <div class="col-12 col-md-6">
            <label class="form-label">Plat c Kč</label>
            <input type="number" step="0.01" class="form-control" formControlName="salaryAmount" />
          </div>

          <div class="col-12 col-md-6">
            <label class="form-label">Nadřízený</label>
            <div class="dropdown w-100">
              <button type="button"
                class="btn btn-outline-secondary dropdown-toggle w-100 text-start"
                data-bs-toggle="dropdown">
                {{ superiorText() }}
              </button>
              <ul class="dropdown-menu w-100">
                <li>
                  <button type="button" class="dropdown-item" (click)="setSuperior(null)">— žádný —</button>
                </li>
                <li><hr class="dropdown-divider"></li>
                <li *ngFor="let e of superiors()">
                  <button type="button" class="dropdown-item" (click)="setSuperior(e.id!)">
                    {{ e.firstName }} {{ e.lastName }}
                  </button>
                </li>
              </ul>
            </div>
          </div>

          <div class="col-12">
            <label class="form-label">Adresa</label>
            <div class="dropdown w-100">
              <button type="button"
                class="btn btn-outline-secondary dropdown-toggle w-100 text-start"
                data-bs-toggle="dropdown">
                {{ addressText() }}
              </button>
              <ul class="dropdown-menu w-100 dropdown-scroll">
                <li>
                  <button type="button" class="dropdown-item" (click)="setAddress(null)">— žádná —</button>
                </li>
                <li><hr class="dropdown-divider"></li>
                <li *ngFor="let a of addresses()">
                  <button type="button" class="dropdown-item" (click)="setAddress(a.id!)">
                    {{ addressLabel(a) }}
                  </button>
                </li>
              </ul>
            </div>
          </div>

          <div class="col-12">
            <label class="form-label">Pracovní pozice</label>
            <div class="dropdown w-100" data-bs-auto-close="outside">
              <button type="button"
                class="btn btn-outline-secondary dropdown-toggle w-100 text-start"
                data-bs-toggle="dropdown">
                {{ jobCategoriesText() }}
              </button>

              <div class="dropdown-menu w-100 p-2 dropdown-scroll">
                <button type="button" class="btn btn-sm btn-outline-secondary w-100 mb-2"
                  (click)="clearJobCategories()">
                  Vymazat výběr
                </button>

                <div class="form-check py-1" *ngFor="let jc of jobCategories()">
                  <input class="form-check-input" type="checkbox"
                    [id]="'jc-' + jc.id"
                    [checked]="isJobCategorySelected(jc.id)"
                    (change)="toggleJobCategory(jc.id, $any($event.target).checked)" />
                  <label class="form-check-label" [for]="'jc-' + jc.id">
                    {{ jc.name }}
                  </label>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>

      <div class="card-footer bg-white d-flex gap-2">
        <button class="btn btn-primary" type="submit" [disabled]="form.invalid || saving()">
          <span *ngIf="saving()" class="spinner-border spinner-border-sm me-2" aria-hidden="true"></span>
          Vytvořit
        </button>
        <a class="btn btn-outline-secondary" routerLink="/employees">Zrušit</a>
      </div>
    </div>
  </fieldset>
</form>
